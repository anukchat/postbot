FROM node:18-alpine

ARG VITE_SUPABASE_URL
ARG VITE_SUPABASE_ANON_KEY
ARG VITE_API_URL
ARG VITE_REDIRECT_URL

ENV VITE_SUPABASE_URL=$VITE_SUPABASE_URL
ENV VITE_SUPABASE_ANON_KEY=$VITE_SUPABASE_ANON_KEY
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_REDIRECT_URL=$VITE_REDIRECT_URL

WORKDIR /app
COPY src/frontend/project/ ./

RUN npm install
RUN npm run build

RUN npm install -g serve && npm cache clean --force

EXPOSE 3000

CMD ["serve", "-s", "dist", "-l", "3000"]
