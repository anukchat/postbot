version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
        - VITE_API_URL=${VITE_API_URL:-http://localhost:8000}
        - VITE_REDIRECT_URL=${VITE_REDIRECT_URL:-http://localhost:3000}
        - VITE_AUTH_PROVIDER_URL=${VITE_AUTH_PROVIDER_URL}
        - VITE_AUTH_PROVIDER_KEY=${VITE_AUTH_PROVIDER_KEY}
    container_name: postbot-frontend-local
    ports:
      - "3000:3000"
    restart: unless-stopped
    networks:
      - postbot-network

  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: postbot-backend-local
    ports:
      - "8000:8000"
    environment:
      # Required - Database
      - DATABASE_URL=${DATABASE_URL}
      
      # Required - Auth Provider
      - AUTH_PROVIDER=${AUTH_PROVIDER:-supabase}
      - AUTH_PROVIDER_URL=${AUTH_PROVIDER_URL}
      - AUTH_PROVIDER_KEY=${AUTH_PROVIDER_KEY}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      
      # LLM API Keys
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GROQ_API_KEY=${GROQ_API_KEY:-}
      - OLLAMA_API_KEY=${OLLAMA_API_KEY:-}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY:-}
      
      # Reddit API
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID:-}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET:-}
      - REDDIT_USER_AGENT=${REDDIT_USER_AGENT:-}
      
      # Additional APIs
      - SERPER_API_KEY=${SERPER_API_KEY:-}
      - PIXABAY_API_KEY=${PIXABAY_API_KEY:-}
      
      # Application Configuration
      - API_URL=${API_URL:-http://localhost:8000}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:3000}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:5173}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      
      # Cache Configuration
      - AUTH_CACHE_TTL=${AUTH_CACHE_TTL:-300}
      - AUTH_CACHE_SIZE=${AUTH_CACHE_SIZE:-100}
    restart: unless-stopped
    networks:
      - postbot-network
    depends_on:
      - frontend

networks:
  postbot-network:
    driver: bridge
